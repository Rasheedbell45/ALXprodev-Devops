#!/bin/bash

# List of Pokémon to fetch
pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Output directory
output_dir="pokemon_data"
mkdir -p "$output_dir"

# Error log file
error_log="fetch_errors.log"
> "$error_log"  # clear previous errors

# Fetch function with retry logic
fetch_pokemon() {
  local name=$1
  local url="https://pokeapi.co/api/v2/pokemon/$name"
  local output_file="$output_dir/${name}.json"

  echo "Fetching data for $name..."

  # Retry up to 3 times
  for attempt in {1..3}; do
    curl -s -f "$url" -o "$output_file"

    if [ $? -eq 0 ]; then
      echo "Saved data to $output_file ✅"
      return 0
    else
      echo "Attempt $attempt failed for $name."
      sleep 2  # brief wait before retry
    fi
  done

  # Log the failure after 3 attempts
  echo "❌ Failed to fetch data for $name after 3 attempts." | tee -a "$error_log"
  return 1
}

# Main loop
for pokemon in "${pokemon_list[@]}"; do
  fetch_pokemon "$pokemon"
  sleep 2  # wait to avoid rate-limiting
done
