#!/bin/bash

# Directory containing PokÃ©mon JSON files
data_dir="pokemon_data"
report_file="pokemon_report.csv"
temp_file="temp_pokemon_data.txt"

# Header for the CSV
echo "Name,Height (m),Weight (kg)" > "$report_file"
> "$temp_file"  # Clear temp file

# Process each JSON file
for json_file in "$data_dir"/*.json; do
  # Extract name, height, and weight
  name=$(jq -r '.name' "$json_file" | sed 's/.*/\u&/')
  height_dm=$(jq -r '.height' "$json_file")
  weight_hg=$(jq -r '.weight' "$json_file")

  # Convert to meters and kg
  height_m=$(awk "BEGIN { printf \"%.2f\", $height_dm / 10 }")
  weight_kg=$(awk "BEGIN { printf \"%.2f\", $weight_hg / 10 }")

  # Write to CSV and temp file
  echo "$name,$height_m,$weight_kg" >> "$report_file"
  echo "$height_m $weight_kg" >> "$temp_file"
done

# Calculate averages using awk
awk '
  { total_height += $1; total_weight += $2; count++ }
  END {
    avg_height = total_height / count
    avg_weight = total_weight / count
    printf "\nAverage Height: %.2f m\nAverage Weight: %.2f kg\n", avg_height, avg_weight
  }
' "$temp_file"

# Clean up temp file
rm -f "$temp_file"

echo "CSV Report generated at: $report_file"
